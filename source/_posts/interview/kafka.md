---
title: kafka
date: 2021-07-29 11:10:43
---

<!-- toc -->

### - mq使用场景

* 解耦
    * 多个下游相同依赖
    * 数据驱动的任务依赖（下游任务强依赖上游数据到达）
* 异步
    * 上游不关心执行结果
    * 上游关注执行结果，但执行时间很长（改为异步操作，再尝试获取结果）
* 削峰
    * 请求高峰期

### - kafka如何保证消息顺序性

1. 一个partition内保证顺序性
2. 可以通过message key来定义，同一个key的message可以保证只发送到同一个partition

### - kafka如何保证消息可靠性

1. 多副本写入
2. 数据持久化，通过后台线程将消息持久化到磁盘
3. 生产者确认，分片所有副本写入成功才返回。发送失败重试
4. 消费组回复消费成功ack，确保消费一次


